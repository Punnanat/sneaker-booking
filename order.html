<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>ระบบจองคิวรองเท้าสำหรับรุ่นพิเศษ</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: linear-gradient(135deg, #a78bfa 0%, #f0abfc 100%); margin: 0; }
        .order-container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 2px 8px #0001; padding: 32px 24px; }
        .sneaker-img { display: flex; justify-content: center; margin-bottom: 16px; }
        .sneaker-img img { width: 180px; border-radius: 10px; }
        .meta { margin-bottom: 20px; }
        .meta span { display: block; color: #555; }
        .meta .name { font-size: 1.2em; font-weight: bold; color: #222; margin-bottom: 6px; }
        .meta .price { color: #7c3aed; font-size: 1.1em; }
        .badge { color: #16a34a; font-size: 1em; margin-bottom: 8px; }
        form label { display: block; margin-top: 12px; color: #333; }
        form input, form select { width: 100%; padding: 8px; margin-top: 4px; border-radius: 6px; border: 1px solid #ccc; font-size: 1em; }
        .size-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .size-grid label { background: #eee; padding: 6px 12px; border-radius: 6px; cursor: pointer; }
        .size-grid input[type="radio"] { margin-right: 4px; }
        .order-btn { width: 100%; margin-top: 20px; padding: 12px; background: #7c3aed; color: #fff; border: none; border-radius: 8px; font-size: 1.1em; cursor: pointer; }
        .order-btn:hover { background: #5b21b6; }
        .success { color: #1abc9c; text-align: center; margin-top: 12px; }
        .error { color: #e74c3c; text-align: center; margin-top: 12px; }
        .logout-btn { position: fixed; top: 20px; right: 30px; background: #e74c3c; color: #fff; border: none; border-radius: 8px; padding: 8px 18px; font-size: 1em; cursor: pointer; }
    </style>
</head>
<body>
    <button class="logout-btn" onclick="logout()">ออกจากระบบ</button>
    <div class="order-container">
        <div class="sneaker-img"><img id="productImg" src="" alt=""></div>
        <div class="meta">
            <span class="name" id="productName"></span>
            <span id="productCode"></span>
            <span id="productRelease"></span>
            <span id="productStock"></span>
            <span class="price" id="productPrice"></span>
        </div>
        <div class="badge"><i>✔ เปิดจองแล้ว</i></div>
        <form id="orderForm">
            <label>ชื่อ-นามสกุล</label>
            <input type="text" id="customerName" required>
            <label>เบอร์โทรศัพท์</label>
            <input type="tel" id="customerPhone" required>
            <label>อีเมล</label>
            <input type="email" id="customerEmail" required>
            <label>จังหวัดที่จัดส่ง</label>
            <select id="customerProvince" required>
                <option value="">เลือกจังหวัด</option>
                <option>กรุงเทพมหานคร</option>
                <option>เชียงใหม่</option>
                <option>เชียงราย</option>
                <option>นครราชสีมา</option>
                <option>ขอนแก่น</option>
                <option>อุบลราชธานี</option>
                <option>ภูเก็ต</option>
                <option>สงขลา</option>
                <option>อื่นๆ</option>
            </select>
            <label><i class="fas fa-ruler"></i> เลือกไซส์รองเท้า (US)</label>
            <div class="size-grid" id="sizeGrid"></div>
            <button type="submit" class="order-btn">เข้าคิวจอง</button>
        </form>
        <div class="success" id="successMsg"></div>
        <div class="error" id="errorMsg"></div>
    </div>
    <script>
        if (!localStorage.getItem('currentUser')) {
  window.location.href = "login.html";
}

        const products = {
            blackcat: {
                name: 'Nike Air Jordan 4 "Black Cat" 2024',
                code: "CU1110-010",
                price: 8900,
                img: "https://www.sneakerfiles.com/wp-content/uploads/2024/08/air-jordan-4-rm-black-cat-FQ7939-004-release-info-1024x725.jpg",
                release: "25 กันยายน 2025",
                stock: 4
            },
            travis1: {
                name: 'Nike Air Jordan 1 Low OG "Travis Scott"',
                code: "DM7866-162",
                price: 15900,
                img: "https://2app.kicksonfire.com/kofapp/upload/events_images/ipad_travis-scott-x-air-jordan-1-low-og-black-olive-0.png",
                release: "25 กันยายน 2025",
                stock: 3
            },
            yeezy: {
                name: 'adidas Yeezy Boost 350 V2 "Zebra"',
                code: "CP9654",
                price: 12500,
                img: "https://www.sneakerfiles.com/wp-content/uploads/2018/10/adidas-yeezy-boost-350-v2-zebra-restock.jpg",
                release: "25 กันยายน 2025",
                stock: 3
            },
            offwhite: {
                name: 'Nike Air Presto Off-White',
                code: "AA3830-001",
                price: 32000,
                img: "https://www.kickgame.com/cdn/shop/products/Nike-Air-Presto-OW-AA3830-100-White_1.png?v=1658243604",
                release: "25 กันยายน 2025",
                stock: 2
            }
        };
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get('product');
        const product = products[productId] || products.blackcat;
        document.getElementById('productImg').src = product.img;
        document.getElementById('productName').innerText = product.name;
        document.getElementById('productCode').innerText = "รหัส: " + product.code;
        document.getElementById('productRelease').innerText = "วันเปิดขาย: " + product.release;
        document.getElementById('productStock').innerText = "จำนวน: " + product.stock + " คู่";
        document.getElementById('productPrice').innerText = "฿" + product.price.toLocaleString();
        const sizeGrid = document.getElementById('sizeGrid');
        let sizeHTML = '';
        for(let size=7; size<=12; size+=0.5){
            sizeHTML += `<label><input type="radio" name="shoeSize" value="${size}"> ${size}</label>`;
        }
        sizeGrid.innerHTML = sizeHTML;
        // ส่งข้อมูลไป Google Sheet (ใส่ URL Web App จริงของคุณ)
        const SHEET_URL = "https://script.google.com/macros/s/AKfycbzcWS4s4ZpzdSUuQsttQMA0S4CBhhkT5npMCltxFJV0BsYltkIiuPB_AzTwi63eN_XSsQ/exec";
        document.getElementById('orderForm').addEventListener('submit', function(e){
            e.preventDefault();
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const province = document.getElementById('customerProvince').value;
            const size = document.querySelector('input[name="shoeSize"]:checked')?.value;
            const successMsg = document.getElementById('successMsg');
            const errorMsg = document.getElementById('errorMsg');
            successMsg.innerText = '';
            errorMsg.innerText = '';
            if(!name || !phone || !email || !province || !size){
                errorMsg.innerText = 'กรุณากรอกข้อมูลให้ครบถ้วน';
                return;
            }
        fetch(SHEET_URL, {
  method: "POST",
  headers: {
    "Content-Type": "text/plain" // ✅ ไม่มี preflight → ไม่เจอ CORS
  },
  body: JSON.stringify({
    customerName: name,
    email: email,
    phone: phone,
    province: province,
    size: size,
    product: product.name,
    code: product.code
  })

,
                headers: { "Content-Type": "application/json" }
            })
            .then(res => res.text())
            .then(txt => {
  if (txt.toLowerCase().includes("success")) {
    successMsg.innerText = "สั่งจองสำเร็จ! ข้อมูลถูกส่งไป Google Sheet แล้ว";
    document.getElementById('orderForm').reset();
  } else {
    errorMsg.innerText = "เกิดข้อผิดพลาด กรุณาลองใหม่";
  }
})

            .catch(()=> errorMsg.innerText = "เกิดข้อผิดพลาดในการเชื่อมต่อ");
        });
        function logout(){
            localStorage.removeItem('currentUser');
            window.location.href = "SNEAKER-SPECIAL.html";
        }
    </script>
</body>
</html>